//=============================================================================
// LN_AdvancedMapPuzzleSystem.js
// ----------------------------------------------------------------------------
// Copyright (c) 2020 lriki
// This software is released under the MIT License.
// http://opensource.org/licenses/mit-license.php
// ----------------------------------------------------------------------------
// [GitHub] : https://github.com/lriki/LN_AdvancedMapPuzzleSystem
// [Twitter]: https://twitter.com/lriki8
//=============================================================================

/*:ja
 * @plugindesc 謎解きマップシステムプラグイン v0.2.0
 * @author lriki
 * @param MapSkillEffectsMapId
 * @desc TODO
 * @type number
 * @default 1
 * 
 * @param GuideLineTerrainTag
 * @desc 箱オブジェクトの移動ガイドラインとなる地形タグです。
 * @type number
 * @default 7
 *
 * @help マップ上のキャラクター移動やイベントシステムを拡張し、
 * 謎解きの幅を広げるための様々な機能を追加します。
 * 
 * MIT License
 */


!function(r){var a={};function i(t){if(a[t])return a[t].exports;var e=a[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}i.m=r,i.c=a,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(r,a,function(t){return e[t]}.bind(null,a));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=5)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=DataManager.onLoad;DataManager.onLoad=function(t){if(i.call(this,t),t===$dataMapSkillEffectsMap){this.extractMetadata(t);for(var e=t.events,r=0;r<e.length;r++){var a=e[r];a&&void 0!==a.note&&this.extractMetadata(a)}}};var a=(n.padZero=function(t,e){for(var r=t;r.length<e;)r="0"+r;return r},n.init=function(){DataManager.loadDataFile("$dataMapSkillEffectsMap","Map001.json")},n.tempMapSkillEffectDataId=-1,n.tempMapSkillEffectInvokerId=-1,n.pluginCommand=function(t,e){switch(t){case"AMPS-MapSkill":switch(e[0]){case"call":$gameMap.spawnMapSkillEffectEvent(e[1])}}},n);function n(){}e.AMPSManager=a},function(t,e,r){"use strict";var a,i,n,o;Object.defineProperty(e,"__esModule",{value:!0}),e.assert=function(t,e){if(!t)throw new Error(e)},(i=a=e.ObjectType||(e.ObjectType={}))[i.Character=0]="Character",i[i.Box=1]="Box",i[i.Effect=2]="Effect",i[i.Reactor=3]="Reactor",(o=n=e.EventTrigger||(e.EventTrigger={}))[o.None=0]="None",o[o.OnCharacterRideOn=1]="OnCharacterRideOn",o[o.OnStartedFalling=2]="OnStartedFalling",o[o.OnSpawnedAsEffect=3]="OnSpawnedAsEffect",o[o.OnCollidedAsEffect=4]="OnCollidedAsEffect",e.strToObjectType=function(t){var e=t.toLocaleLowerCase();return"box"===e?a.Box:"effect"===e?a.Effect:"reactor"===e?a.Reactor:a.Character},e.strToEventTrigger=function(t){var e=t.toLocaleLowerCase();return"oncharacterrideon"===e?n.OnCharacterRideOn:"onstartedfalling"===e?n.OnStartedFalling:"onspawnedaseffect"===e?n.OnSpawnedAsEffect:"oncollidedaseffect"===e?n.OnCollidedAsEffect:n.None}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a="LN_AdvancedMapPuzzleSystem";e.paramMapSkillEffectsMapId=Number(PluginManager.parameters(a).MapSkillEffectsMapId),e.paramGuideLineTerrainTag=Number(PluginManager.parameters(a).GuideLineTerrainTag)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a={name:"Evasion1",volume:80,pitch:110,pan:0},i={name:"Earth3",volume:80,pitch:100,pan:0},n=SoundManager.preloadImportantSounds;SoundManager.preloadImportantSounds=function(){n.call(SoundManager),$dataSystem&&AudioManager.loadStaticSe(a)};var o=(s.playGSJump=function(){$dataSystem&&AudioManager.playStaticSe(a)},s.playGSFalled=function(){AudioManager.playSe(i)},s);function s(){}e.AMPS_SoundManager=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=r(1),p=r(2),a=(f.isHalfStepX=function(t){return Math.floor(t.x)!==t.x},f.isHalfStepY=function(t){return Math.floor(t.y)!==t.y},f.frontX=function(t,e){return t+(6===e?1:4===e?-1:0)},f.frontY=function(t,e){return t+(2===e?1:8===e?-1:0)},f.frontXAligned=function(t,e){return Math.round(t)+(6===e?1:4===e?-1:0)},f.frontYAligned=function(t,e){return Math.round(t)+(2===e?1:8===e?-1:0)},f.roundXWithDirection=function(t,e){return $gameMap.roundX(t+(6===e?1:4===e?-1:0))},f.roundYWithDirection=function(t,e){return $gameMap.roundY(t+(2===e?1:8===e?-1:0))},f.roundXWithDirectionLong=function(t,e,r){for(var a=f.roundXWithDirection(t,e),i=Math.floor(r),n=0;n<i-1;n++)a=f.roundXWithDirection(a,e);var o=r-Math.floor(r);return 0<o&&(a+=f.roundXWithDirection(0,e)*o),a},f.roundYWithDirectionLong=function(t,e,r){for(var a=f.roundYWithDirection(t,e),i=Math.floor(r),n=0;n<i-1;n++)a=f.roundYWithDirection(a,e);var o=r-Math.floor(r);return 0<o&&(a+=f.roundYWithDirection(0,e)*o),a},f.checkFacingOutsideOnEdgeTile=function(t,e,r){var a=Math.round(t),i=Math.round(e);return!$gameMap.isPassable(a,i,r)},f.checkFacingOtherEdgeTile=function(t,e,r,a){var i=Math.round(f.roundXWithDirectionLong(t,r,a)),n=Math.round(f.roundYWithDirectionLong(e,r,a));return!$gameMap.isPassable(i,n,f.reverseDir(r))},f.canPassJumpGroove=function(t,e,r,a){if(2!=a&&8!=a||!f.isHalfStepX(t))return f.canPassJumpGrooveInternal(t,e,r,a);var i=f.canPassJumpGrooveInternal(t,e-1,r,a),n=f.canPassJumpGrooveInternal(t,e,r,a);return!(!i||!n)&&n},f.canPassJumpGrooveInternal=function(t,e,r,a){var i=Math.round(e),n=Math.round(r),o=Math.round(f.roundXWithDirectionLong(e,a,2)),s=Math.round(f.roundYWithDirectionLong(r,a,2)),c=Math.round(f.roundXWithDirectionLong(e,a,1)),p=Math.round(f.roundYWithDirectionLong(r,a,1)),h=f.roundXWithDirectionLong(e,a,2),u=f.roundYWithDirectionLong(r,a,2);if(!$gameMap.isValid(o,s))return!1;if(!$gameMap.isPassable(i,n,a))return!1;var l=t.reverseDir(a);return!!$gameMap.isPassable(o,s,l)&&!t.isCollidedWithCharacters(h,u)&&!!$gameMap.checkGroove(c,p)},f.checkJumpGroundToGroundInternal=function(t,e,r,a,i){var n=Math.round(e),o=Math.round(r),s=f.roundXWithDirectionLong(e,a,i),c=f.roundYWithDirectionLong(r,a,i),p=Math.round(s),h=Math.round(c);if(!$gameMap.isValid(p,h))return{pass:!1,x:0,y:0};var u=t.reverseDir(a);if($gameMap.isPassable(n,o,a)||$gameMap.isPassable(p,h,u))return{pass:!1,x:0,y:0};if($gameMap.checkNotPassageAll(p,h))return{pass:!1,x:0,y:0};if(t.isCollidedWithCharacters(s,c))return{pass:!1,x:0,y:0};var l=f.roundXWithDirectionLong(e,a,1),d=f.roundYWithDirectionLong(r,a,1);return f.isCollidedWithRiddingEvents(l,d)?{pass:!1,x:0,y:0}:{pass:!0,x:s,y:c}},f.checkMoveOrJumpGroundToObject=function(t,e,r,a,i){var n=Math.round(t),o=Math.round(e),s=Math.round(f.roundXWithDirectionLong(t,r,a)),c=Math.round(f.roundYWithDirectionLong(e,r,a));if(i||!$gameMap.isPassable(n,o,r)){var p=f.findPassableRideObject(s,c);return p||void 0}},f.checkMoveOrJumpObjectToGround=function(t,e,r,a,i){var n=Math.round(f.roundXWithDirectionLong(e,a,i)),o=Math.round(f.roundYWithDirectionLong(r,a,i));if(t.objectType()==c.ObjectType.Box&&!t.falling()&&$gameMap.terrainTag(n,o)!=p.paramGuideLineTerrainTag)return!1;var s=t.reverseDir(a);return!$gameMap.isPassable(n,o,s)&&!$gameMap.checkNotPassageAll(n,o)&&!t.isCollidedWithCharacters(n,o)},f.checkMoveOrJumpObjectToObject=function(t,e,r,a){var i=Math.round(f.roundXWithDirectionLong(t,r,a)),n=Math.round(f.roundYWithDirectionLong(e,r,a)),o=f.findPassableRideObject(i,n);if(o)return o},f.isCollidedWithRiddingEvents=function(t,e){return $gameMap.eventsXyNt(t,e).some(function(t){return t.isRidding()})},f.findPassableRideObject=function(t,e){for(var r=$gameMap.events(),a=0;a<r.length;a++)if(r[a].checkPassRide(t,e))return r[a]},f.findCharacterById=function(t){return 0==t?$gamePlayer:$gameMap.events()[t-1]},f.findReactorMapObjectInLineRange=function(t,e,r,a,i){var n=i.toLocaleLowerCase(),o=0;$gameMap.isPassable(t,e,r)||o--;for(var s=0;s<a;s++){var c=Math.round(f.roundXWithDirectionLong(t,r,s+1)),p=Math.round(f.roundYWithDirectionLong(e,r,s+1)),h=this.reverseDir(r);if($gameMap.isPassable(c,p,h)||o++,console.log(o),0===o)for(var u=$gameMap.eventsXyNt(c,p),l=0;l<u.length;l++){var d=u[l];if(d.isMapObject()&&d.reactionMapSkill()==n)return d}if($gameMap.isValid(c,p-1)&&f.checkLayeredTilesFlags($gameMap,c,p-1,16))return;if($gameMap.eventsXyNt(c,p).some(function(t){return 1<=t.objectHeight()}))return;$gameMap.isPassable(c,p,r)||o--}},f.canPassJumpGroundToGround=function(t,e,r,a){if(Math.round(e),Math.round(r),Math.round(f.roundXWithDirectionLong(e,a,2)),Math.round(f.roundYWithDirectionLong(r,a,2)),2==a||8==a){var i=2-(r-Math.floor(r));if(f.isHalfStepX(t)){var n=f.checkJumpGroundToGroundInternal(t,e-1,r,a,i),o=f.checkJumpGroundToGroundInternal(t,e,r,a,i);return!(!n.pass||!o.pass)&&o.pass}return f.checkJumpGroundToGroundInternal(t,e,r,a,i).pass}if(!f.isHalfStepY(t)||4!=a&&6!=a)return f.checkJumpGroundToGroundInternal(t,e,r,a,2).pass;if(!(n=f.checkJumpGroundToGroundInternal(t,e,r,a,2)).pass)return!1;var s=n.x,c=Math.ceil(n.y);return!(t.isCollidedWithCharacters(s,c)&&!(o=f.checkJumpGroundToGroundInternal(t,Math.round(e),c-1,a,2)).pass)&&n.pass},f.findObject=function(t,e){for(var r=$gameMap.eventsXyNt(t,e),a=0;a<r.length;a++)if(r[a].isMapObject())return r[a]},f.checkLayeredTilesFlags=function(t,e,r,a){var i=t.tilesetFlags();return t.layeredTiles(e,r).some(function(t){return 0!==t&&0!=(i[t]&a)})},f.reverseDir=function(t){return 10-t},f.linear=function(t,e,r,a){return r*(t/a)+e},f.easeInExpo=function(t,e,r,a){return r*Math.pow(2,10*(t/a-1))+e},f.distance2D=function(t,e,r,a){var i=r-t,n=a-e;return Math.sqrt(i*i+n*n)},f);function f(){}e.MovingHelper=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),r(2),r(0),r(3),r(6),r(7),r(8),r(9),r(10),r(11),r(12)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,a,i=r(1),s=r(4),c=r(3);(a=o=o||{})[a.Stopping=0]="Stopping",a[a.GroundToGround=1]="GroundToGround",a[a.GroundToObject=2]="GroundToObject",a[a.ObjectToObject=3]="ObjectToObject",a[a.ObjectToGround=4]="ObjectToGround";var n=Game_CharacterBase.prototype.initMembers;Game_CharacterBase.prototype.initMembers=function(){n.call(this),this._objectType=i.ObjectType.Character,this._ridderCharacterId=-1,this._riddeeCharacterId=-1,this._waitAfterJump=0,this._extraJumping=!1,this._ridingScreenZPriority=-1,this._movingMode=o.Stopping,this._forcePositionAdjustment=!1,this._moveToFalling=!1,this._getonoffFrameCount=0,this._getonoffFrameMax=0,this._getonoffStartX=0,this._getonoffStartY=0};var p=Game_CharacterBase.prototype.moveStraight;Game_CharacterBase.prototype.moveStraight=function(t){i.assert(2==t||4==t||6==t||8==t),0<this._waitAfterJump?this._waitAfterJump--:this.moveStraightMain(t)};var h=Game_CharacterBase.prototype.moveDiagonally;Game_CharacterBase.prototype.moveDiagonally=function(t,e){this.isRidding()||h.call(this,t,e)},Game_CharacterBase.prototype.isRidding=function(){return 0<=this._riddeeCharacterId},Game_CharacterBase.prototype.falling=function(){return!1},Game_CharacterBase.prototype.isMapObject=function(){return!1},Game_Event.prototype.objectType=function(){return this._objectType},Game_CharacterBase.prototype.objectId=function(){return-1},Game_CharacterBase.prototype.objectType=function(){return this._objectType},Game_CharacterBase.prototype.objectHeight=function(){return-1},Game_CharacterBase.prototype.canRide=function(){return 0<=this.objectHeight()},Game_CharacterBase.prototype.checkPassRide=function(t,e){if(this.canRide()&&!this.rider()){var r=Math.round(this._x),a=Math.round(this._y)-this.objectHeight();if(t==r&&e==a)return!0}return!1},Game_CharacterBase.prototype.rider=function(){return this._ridderCharacterId<0?void 0:0==this._ridderCharacterId?$gamePlayer:$gameMap.event(this._ridderCharacterId)},Game_CharacterBase.prototype.riddingObject=function(){return this._riddeeCharacterId<0?void 0:0==this._riddeeCharacterId?$gamePlayer:$gameMap.event(this._riddeeCharacterId)};var u=Game_CharacterBase.prototype.screenZ;Game_CharacterBase.prototype.screenZ=function(){var t=u.call(this),e=this.riddingObject();return this.isRidding()&&e&&(t+=e.screenZ()),0<=this._ridingScreenZPriority&&(t=this._ridingScreenZPriority),t+(this._extraJumping?6:0)},Game_CharacterBase.prototype.moveStraightMain=function(t){this.setMovementSuccess(!1),this.isRidding()?(this.attemptMoveObjectToGround(t)||this.attemptMoveObjectToObject(t)||this.attemptJumpObjectToGround(t)||this.attemptJumpObjectToObject(t),this.setDirection(t)):this.attemptMoveGroundToGround(t)||this.attemptJumpGroundToGround(t)||this.attemptJumpGroove(t)||this.attemptMoveGroundToObject(t,!1)||this.attemptJumpGroundToObject(t)},Game_CharacterBase.prototype.attemptMoveGroundToGround=function(t){var e=this._x,r=this._y;return p.call(this,t),!!this._movementSuccess&&(this._forcePositionAdjustment&&(this._x=Math.round(s.MovingHelper.roundXWithDirection(e,t)),this._y=Math.round(s.MovingHelper.roundYWithDirection(r,t))),this._movingMode=o.GroundToGround,!0)},Game_CharacterBase.prototype.attemptJumpGroundToGround=function(t){return!!s.MovingHelper.canPassJumpGroundToGround(this,this._x,this._y,t)&&(this.setMovementSuccess(!0),this.jumpToDir(t,2,!1),this._movingMode=o.GroundToGround,!0)},Game_CharacterBase.prototype.attemptJumpGroove=function(t){return!!s.MovingHelper.canPassJumpGroove(this,this._x,this._y,t)&&(this.setMovementSuccess(!0),this.jumpToDir(t,2,!1),this._movingMode=o.GroundToGround,!0)},Game_CharacterBase.prototype.attemptMoveGroundToObject=function(t,e){var r=s.MovingHelper.checkMoveOrJumpGroundToObject(this._x,this._y,t,1,e);return!!r&&(this.setMovementSuccess(!0),this.resetGetOnOffParams(),this.moveToDir(t,!0),this.rideToObject(r),this._movingMode=o.GroundToObject,!0)},Game_CharacterBase.prototype.attemptJumpGroundToObject=function(t){var e=s.MovingHelper.checkMoveOrJumpGroundToObject(this._x,this._y,t,2,!1);return!!e&&(this.setMovementSuccess(!0),this.resetGetOnOffParams(),this.jumpToDir(t,2,!0),this.rideToObject(e),this._movingMode=o.GroundToObject,!0)},Game_CharacterBase.prototype.attemptMoveObjectToGround=function(t){return i.assert(this.isRidding()),!!s.MovingHelper.checkMoveOrJumpObjectToGround(this,this._x,this._y,t,1)&&(this.setMovementSuccess(!0),this.resetGetOnOffParams(),this.moveToDir(t,!1),this.unrideFromObject(),this._movingMode=o.ObjectToGround,!0)},Game_CharacterBase.prototype.attemptMoveObjectToObject=function(t){i.assert(this.isRidding());var e=s.MovingHelper.checkMoveOrJumpObjectToObject(this._x,this._y,t,1);return!(!e||e==this)&&(this.setMovementSuccess(!0),this.resetGetOnOffParams(),this.moveToDir(t,!1),this.unrideFromObject(),this.rideToObject(e),this._movingMode=o.ObjectToObject,!0)},Game_CharacterBase.prototype.attemptJumpObjectToGround=function(t){return!!s.MovingHelper.checkMoveOrJumpObjectToGround(this,this._x,this._y,t,2)&&(this.setMovementSuccess(!0),this.jumpToDir(t,2,!1),this.unrideFromObject(),this._movingMode=o.ObjectToGround,!0)},Game_CharacterBase.prototype.attemptJumpObjectToObject=function(t){var e=s.MovingHelper.checkMoveOrJumpObjectToObject(this._x,this._y,t,2);return!!e&&(this.setMovementSuccess(!0),this.resetGetOnOffParams(),this.jumpToDir(t,2,!0),this.unrideFromObject(),this.rideToObject(e),this._movingMode=o.ObjectToObject,!0)},Game_CharacterBase.prototype.rideToObject=function(t){i.assert(!this.isRidding()),i.assert(0<=this.objectId()),i.assert(0<=t.objectId()),this._riddeeCharacterId=t.objectId(),t._ridderCharacterId=this.objectId();var e=this._ridingScreenZPriority;this._ridingScreenZPriority=-1,this._ridingScreenZPriority=this.screenZ(),this._ridingScreenZPriority=Math.max(this._ridingScreenZPriority,e)},Game_CharacterBase.prototype.unrideFromObject=function(){i.assert(this.isRidding());var t=this.riddingObject();t&&(t._ridderCharacterId=-1),this._riddeeCharacterId=-1},Game_CharacterBase.prototype.moveToDir=function(t,e){this._x=$gameMap.roundXWithDirection(this._x,t),this._y=$gameMap.roundYWithDirection(this._y,t),this._realX=$gameMap.xWithDirection(this._x,this.reverseDir(t)),this._realY=$gameMap.yWithDirection(this._y,this.reverseDir(t)),(e||this._forcePositionAdjustment)&&(this._y=Math.round(this._y)),this._forcePositionAdjustment&&(this._x=Math.round(this._x))},Game_CharacterBase.prototype.jumpToDir=function(t,e,r){var a=this._x,i=this._y;r||(a=Math.round(this._x),2==t||8==t||(i=Math.round(this._y)));var n=Math.round(s.MovingHelper.roundXWithDirectionLong(this._x,t,e)),o=Math.round(s.MovingHelper.roundYWithDirectionLong(this._y,t,e));this.jump(n-a,o-i),this._waitAfterJump=10,this._extraJumping=!0,c.AMPS_SoundManager.playGSJump()},Game_CharacterBase.prototype.startFall=function(){console.log("not implemented.")};var l=Game_CharacterBase.prototype.isMoving;Game_CharacterBase.prototype.isMoving=function(){return(!this.isRidding()||this._movingMode!=o.Stopping)&&l.call(this)};var d=Game_CharacterBase.prototype.update;Game_CharacterBase.prototype.update=function(){var t;d.call(this),this.falling()&&console.log("not implemented."),!this.isRidding()||this._movingMode!=o.Stopping||(t=this.riddingObject())&&(this._x=t._x,this._y=t._y-t.objectHeight(),this._realX=t._realX,this._realY=t._realY-t.objectHeight())};var f=Game_CharacterBase.prototype.updateStop;Game_CharacterBase.prototype.updateStop=function(){f.call(this),this.isRidding()||(this._ridingScreenZPriority=-1),this._movingMode=o.Stopping};var m=Game_CharacterBase.prototype.updateMove;Game_CharacterBase.prototype.updateMove=function(){var t,e,r,a,i=this.isMoving();this.isMoving()&&this._movingMode!=o.Stopping&&this._movingMode!=o.GroundToGround?(this._getonoffFrameCount++,e=t=0,this._movingMode==o.GroundToObject||this._movingMode==o.ObjectToObject?(r=this.riddingObject())&&(t=r._realX,e=r._realY-r.objectHeight()):this._movingMode==o.ObjectToGround&&(t=this._x,e=this._y),a=Math.min(this._getonoffFrameCount/this._getonoffFrameMax,1),this._realX=s.MovingHelper.linear(a,this._getonoffStartX,t-this._getonoffStartX,1),this._realY=s.MovingHelper.linear(a,this._getonoffStartY,e-this._getonoffStartY,1),this._getonoffFrameCount>=this._getonoffFrameMax&&(this._movingMode=o.Stopping)):m.call(this),i==this.isMoving()||this.isMoving()||(this._moveToFalling?(this._moveToFalling=!1,this.startFall()):this.onStepEnd())};var _=Game_CharacterBase.prototype.updateJump;Game_CharacterBase.prototype.updateJump=function(){var t,e,r,a,i,n=this.isJumping();_.call(this),this.isRidding()&&n&&(this._movingMode!=o.GroundToObject&&this._movingMode!=o.ObjectToObject||(t=this.riddingObject())&&(e=t._realX,r=t._realY-t.objectHeight(),a=2*this._jumpPeak,i=Math.min((a-this._jumpCount+1)/a,1),this._realX=s.MovingHelper.linear(i,this._getonoffStartX,e-this._getonoffStartX,1),this._realY=s.MovingHelper.linear(i,this._getonoffStartY,r-this._getonoffStartY,1),this._x=t._x,this._y=t._y-t.objectHeight())),this.isJumping()||(this._extraJumping=!1,this._movingMode=o.Stopping,n!=this.isJumping()&&this.onJumpEnd())},Game_CharacterBase.prototype.resetGetOnOffParams=function(){this._getonoffFrameMax=1/this.distancePerFrame(),this._getonoffFrameCount=0,this._getonoffStartX=this._realX,this._getonoffStartY=this._realY},Game_CharacterBase.prototype.onStepEnd=function(){var t=this.riddingObject();t&&t.onCharacterRideOn()},Game_CharacterBase.prototype.onJumpEnd=function(){var t=this.riddingObject();t&&t.onCharacterRideOn()},Game_CharacterBase.prototype.onCharacterRideOn=function(){}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Game_Player.prototype.objectId=function(){return 0};var a=Game_Player.prototype.isCollided;Game_Player.prototype.isCollided=function(t,e){return!this.isRidding()&&a.call(this,t,e)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,a,i=r(2),c=r(1),n=r(0),o=r(4);(a=s=s||{})[a.Default=0]="Default",a[a.Front=1]="Front";var p=Game_Event.prototype.initMembers;Game_Event.prototype.initMembers=function(){p.call(this),this._objectType=c.ObjectType.Character,this._objectHeight=-1,this._fallable=!1,this._mapObjectEventTrigger=c.EventTrigger.None,this._mapSkillEffectDataId=n.AMPSManager.tempMapSkillEffectDataId,this._mapSkillEffectInvokerId=n.AMPSManager.tempMapSkillEffectInvokerId,this._mapSkillEffectInitialPosition=s.Default};var h=Game_Event.prototype.event;Game_Event.prototype.event=function(){return $dataMapSkillEffectsMap.events&&this._mapId===i.paramMapSkillEffectsMapId?(c.assert(0<=this._mapSkillEffectDataId),$dataMapSkillEffectsMap.events[this._mapSkillEffectDataId]):h.call(this)},Game_Event.prototype.isMapObject=function(){return this._objectType!=c.ObjectType.Character},Game_Event.prototype.objectId=function(){return this.eventId()},Game_Event.prototype.objectHeight=function(){return this._objectHeight},Game_Event.prototype.reactionMapSkill=function(){return this._reactionMapSkill},Game_Event.prototype.mapSkillEffectInvoker=function(){return this._mapSkillEffectInvokerId<0?void 0:0==this._mapSkillEffectInvokerId?$gamePlayer:$gameMap.event(this._mapSkillEffectInvokerId)},Game_Event.prototype.directionAsMapSkillEffect=function(){var t=this.mapSkillEffectInvoker();return t?t.direction():this.direction()};var u=Game_Event.prototype.refresh;Game_Event.prototype.refresh=function(){u.call(this);var t=this.mapSkillEffectInvoker();t&&((this._mapSkillEffectInitialPosition=s.Front)?this.locate(o.MovingHelper.frontX(t.x,t.direction()),o.MovingHelper.frontY(t.y,t.direction())):this.locate(t.x,t.y))};var l=Game_Event.prototype.setupPage;Game_Event.prototype.setupPage=function(){var t,e,r,a=this.objectHeight(),i=this.rider();l.call(this),this.parseListCommentForAMPSObject(),0==this.objectHeight()&&i&&i.jump(0,a),this._objectType==c.ObjectType.Effect&&this._mapObjectEventTrigger==c.EventTrigger.OnSpawnedAsEffect&&(!(e=this.mapSkillEffectInvoker())||(r=o.MovingHelper.findReactorMapObjectInLineRange(e.x,e.y,this.directionAsMapSkillEffect(),this._mapSkillRange,null!==(t=this.event().name)&&void 0!==t?t:""))&&r.startAsReactor())},Game_Event.prototype.parseListCommentForAMPSObject=function(){this._objectType=c.ObjectType.Character,this._objectHeight=-1,this._fallable=!1,this._mapObjectEventTrigger=c.EventTrigger.None,this._mapSkillRange=-1,this._reactionMapSkill="",this._mapSkillEffectInitialPosition=s.Default;var t=this.list();if(t){for(var e="",r=0;r<t.length;r++)108!=t[r].code&&408!=t[r].code||t[r].parameters&&(e+=t[r].parameters);var a=e.indexOf("@MapObject");if(0<=a){for(var i=e.substring(a+6),n=(i=i.substring(i.indexOf("{")+1,i.indexOf("}"))).split(","),r=0;r<n.length;r++){var o=n[r].split(":");switch(o[0].trim()){case"type":this._objectType=c.strToObjectType(o[1].trim());break;case"h":case"height":this._objectHeight=Number(o[1].trim());break;case"fallable":this._fallable="true"==o[1].trim();break;case"trigger":this._mapObjectEventTrigger=c.strToEventTrigger(o[1].trim());break;case"range":this._mapSkillRange=Number(o[1].trim());break;case"reaction":this._reactionMapSkill=o[1].trim().toLocaleLowerCase();break;case"pos":switch(o[1].trim().toLocaleLowerCase()){case"front":this._mapSkillEffectInitialPosition=s.Front}}}return!0}}return!1};var d=Game_Event.prototype.start;Game_Event.prototype.start=function(){this.objectType()==c.ObjectType.Reactor||d.call(this)},Game_Event.prototype.startAsReactor=function(){d.call(this)};var f=Game_Event.prototype.updateParallel;Game_Event.prototype.updateParallel=function(){var t;this._interpreter?(t=this._interpreter.isRunning(),f.call(this),t&&!this._interpreter.isRunning()&&this.onTerminateParallelEvent()):f.call(this)},Game_Event.prototype.onTerminateParallelEvent=function(){this._mapId===i.paramMapSkillEffectsMapId&&$gameMap.despawnMapSkillEffectEvent(this)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r(2),n=r(0),a=r(1);Game_Map.prototype.checkPassage=function(t,e,r){for(var a=this.tilesetFlags(),i=this.allTiles(t,e),n=0;n<i.length;n++){var o=a[i[n]];if(a[i[n]]>>12!=s.paramGuideLineTerrainTag&&0==(16&o)){if(0==(o&r))return!0;if((o&r)===r)return!1}}return!1},Game_Map.prototype.checkNotPassageAll=function(t,e){for(var r=this.tilesetFlags(),a=this.allTiles(t,e),i=0,n=0;n<a.length;n++){i|=r[a[n]]}return 15==(15&i)},Game_Map.prototype.checkGroove=function(t,e){for(var r=this.allTiles(t,e),a=0;a<r.length;a++)if(Tilemap.isTileA1(r[a]))return!0;return!1},Game_Map.prototype.spawnMapSkillEffectEvent=function(t){if(console.log($dataMapSkillEffectsMap),$dataMapSkillEffectsMap.events){for(var e=-1,r=0;r<$dataMapSkillEffectsMap.events.length;r++)if($dataMapSkillEffectsMap.events[r]&&$dataMapSkillEffectsMap.events[r].name==t){e=r;break}if(0<=e){n.AMPSManager.tempMapSkillEffectDataId=e,n.AMPSManager.tempMapSkillEffectInvokerId=0;var a=this._events.length,i=new Game_Event(s.paramMapSkillEffectsMapId,a);return n.AMPSManager.tempMapSkillEffectDataId=-1,n.AMPSManager.tempMapSkillEffectInvokerId=-1,i._eventIndex=a,this._events[a]=i,this._spawnMapSkillEffectEventcallback&&this._spawnMapSkillEffectEventcallback(i),i}}},Game_Map.prototype.despawnMapSkillEffectEvent=function(t){a.assert(0<=t._eventIndex),this._events.splice(t._eventIndex,1),this._despawnMapSkillEffectEventcallback&&this._despawnMapSkillEffectEventcallback(t)},Game_Map.prototype.setSpawnMapSkillEffectEventHandler=function(t){this._spawnMapSkillEffectEventcallback=t},Game_Map.prototype.setDespawnMapSkillEffectEventHandler=function(t){this._despawnMapSkillEffectEventcallback=t}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r(0),i=Game_Interpreter.prototype.pluginCommand;Game_Interpreter.prototype.pluginCommand=function(t,e){i.call(this,t,e),a.AMPSManager.pluginCommand(t,e)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r(1),i=Spriteset_Map.prototype.createCharacters;Spriteset_Map.prototype.createCharacters=function(){i.call(this),$gameMap.setSpawnMapSkillEffectEventHandler(this.onSpawnMapSkillEffectEvent.bind(this)),$gameMap.setDespawnMapSkillEffectEventHandler(this.onDespawnMapSkillEffectEvent.bind(this))},Spriteset_Map.prototype.onSpawnMapSkillEffectEvent=function(t){a.assert(null!=t._eventIndex);var e=new Sprite_Character(t);this._characterSprites.push(e),this._tilemap.addChild(e)},Spriteset_Map.prototype.onDespawnMapSkillEffectEvent=function(t){a.assert(null!=t._eventIndex);for(var e=0;e<this._characterSprites.length;e++){var r=this._characterSprites[e]._character;if(r&&null!=r._eventIndex&&r._eventIndex==t._eventIndex){this._tilemap.removeChild(this._characterSprites[e]),this._characterSprites.splice(e,1);break}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r(0),i=Scene_Boot.prototype.create;Scene_Boot.prototype.create=function(){i.call(this),a.AMPSManager.init()}}]);